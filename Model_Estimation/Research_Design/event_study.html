
<!DOCTYPE html>
<html lang="en-US">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=Edge">
  <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
  <link rel="stylesheet" href="/assets/css/just-the-docs-default.css">
    <script type="text/javascript" src="/assets/js/vendor/lunr.min.js"></script>
  <script type="text/javascript" src="/assets/js/just-the-docs.js"></script>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!-- Begin Jekyll SEO tag v2.6.1 -->
<title>Difference in Differences Event Study | LOST</title>
<meta name="generator" content="Jekyll v4.1.1" />
<meta property="og:title" content="Difference in Differences Event Study" />
<meta property="og:locale" content="en_US" />
<meta property="og:site_name" content="LOST" />
<script type="application/ld+json">
{"headline":"Difference in Differences Event Study","@type":"WebPage","url":"/Model_Estimation/Research_Design/event_study.html","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
  <script type="text/x-mathjax-config">
    MathJax.Hub.Config({ TeX: { equationNumbers: { autoNumber: "AMS" } } });
  </script>
  <script type="text/javascript" async
    src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS_CHTML">
  </script>
</head>
<body>
  <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
    <symbol id="svg-link" viewBox="0 0 24 24">
      <title>Link</title>
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link">
        <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path>
      </svg>
    </symbol>
    <symbol id="svg-search" viewBox="0 0 24 24">
      <title>Search</title>
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search">
        <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line>
      </svg>
    </symbol>
    <symbol id="svg-menu" viewBox="0 0 24 24">
      <title>Menu</title>
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu">
        <line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line>
      </svg>
    </symbol>
    <symbol id="svg-arrow-right" viewBox="0 0 24 24">
      <title>Expand</title>
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right">
        <polyline points="9 18 15 12 9 6"></polyline>
      </svg>
    </symbol>
    <symbol id="svg-doc" viewBox="0 0 24 24">
      <title>Document</title>
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file">
        <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline>
      </svg>
    </symbol>
  </svg>
  <div class="side-bar">
    <div class="site-header">
      <a href="/" class="site-title lh-tight">
  LOST
</a>
      <a href="#" id="menu-button" class="site-button">
        <svg viewBox="0 0 24 24" class="icon"><use xlink:href="#svg-menu"></use></svg>
      </a>
    </div>
    <nav role="navigation" aria-label="Main" id="site-nav" class="site-nav">
      <ul class="nav-list"><li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="/Data_Manipulation/data_manipulation.html" class="nav-list-link">Data Manipulation</a><ul class="nav-list "><li class="nav-list-item "><a href="/Data_Manipulation/Regular_Expressions.html" class="nav-list-link">Regular Expressions</a></li><li class="nav-list-item "><a href="/Data_Manipulation/collapse_a_data_set.html" class="nav-list-link">Collapse a Data Set</a></li><li class="nav-list-item "><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="/Data_Manipulation/Combining_Datasets/combining_datasets_overview.html" class="nav-list-link">Combining Datasets</a><ul class="nav-list"><li class="nav-list-item ">
                        <a href="/Data_Manipulation/Combining_Datasets/combining_datasets_vertical_combination.html" class="nav-list-link">Vertical Combination</a>
                      </li><li class="nav-list-item ">
                        <a href="/Data_Manipulation/Combining_Datasets/combining_datasets_horizontal_merge_deterministic.html" class="nav-list-link">Horizontal Combination (Deterministic)</a>
                      </li></ul></li><li class="nav-list-item "><a href="/Data_Manipulation/creating_a_variable_with_group_calculations.html" class="nav-list-link">Creating a Variable with Group Calculations</a></li><li class="nav-list-item "><a href="/Data_Manipulation/creating_categorical_variables.html" class="nav-list-link">Creating Categorical Variables</a></li><li class="nav-list-item "><a href="/Data_Manipulation/Creating_Dummy_Variables/creating_dummy_variables.html" class="nav-list-link">Creating Dummy Variables</a></li><li class="nav-list-item "><a href="/Data_Manipulation/determine_the_observation_level_of_a_data_set.html" class="nav-list-link">Determine the Observation Level of a Data Set</a></li><li class="nav-list-item "><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="/Data_Manipulation/Reshaping/reshape.html" class="nav-list-link">Reshaping Data</a><ul class="nav-list"><li class="nav-list-item ">
                        <a href="/Data_Manipulation/Reshaping/reshape_panel_data_from_wide_to_long.html" class="nav-list-link">Reshape Panel Data from Wide to Long</a>
                      </li><li class="nav-list-item ">
                        <a href="/Data_Manipulation/Reshaping/reshape_panel_data_from_long_to_wide.html" class="nav-list-link">Reshape Panel Data from Long to Wide</a>
                      </li></ul></li><li class="nav-list-item "><a href="/Data_Manipulation/rowwise_calculations.html" class="nav-list-link">Rowwise Calculations</a></li></ul></li><li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="/Geo-Spatial/Geo-spatial.html" class="nav-list-link">Geo-Spatial</a><ul class="nav-list "><li class="nav-list-item "><a href="/Geo-Spatial/choropleths.html" class="nav-list-link">Choropleths</a></li><li class="nav-list-item "><a href="/Geo-Spatial/geocoding.html" class="nav-list-link">Geocoding</a></li><li class="nav-list-item "><a href="/Geo-Spatial/merging_shape_files.html" class="nav-list-link">Merging Shape Files</a></li><li class="nav-list-item "><a href="/Geo-Spatial/spatial_joins.html" class="nav-list-link">Spatial Joins</a></li><li class="nav-list-item "><a href="/Geo-Spatial/spatial_lag_model.html" class="nav-list-link">Spatial Lag Model</a></li></ul></li><li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="/Machine_Learning/Machine_Learning.html" class="nav-list-link">Machine Learning</a><ul class="nav-list "><li class="nav-list-item "><a href="/Machine_Learning/Nearest_Neighbor.html" class="nav-list-link">K-Nearest Neighbor Matching</a></li><li class="nav-list-item "><a href="/Machine_Learning/artificial_neural_network.html" class="nav-list-link">Artificial Neural Network</a></li><li class="nav-list-item "><a href="/Machine_Learning/boosted_regression_trees.html" class="nav-list-link">Boosted Regression Trees</a></li><li class="nav-list-item "><a href="/Machine_Learning/causal_forest.html" class="nav-list-link">Causal Forest</a></li><li class="nav-list-item "><a href="/Machine_Learning/decision_trees.html" class="nav-list-link">Decision Trees</a></li><li class="nav-list-item "><a href="/Machine_Learning/penalized_regression.html" class="nav-list-link">Penalized Regression</a></li><li class="nav-list-item "><a href="/Machine_Learning/random_forest.html" class="nav-list-link">Random Forest</a></li><li class="nav-list-item "><a href="/Machine_Learning/support_vector_machine.html" class="nav-list-link">Support Vector Machine</a></li></ul></li><li class="nav-list-item active"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="/Model_Estimation/Model_Estimation.html" class="nav-list-link">Model Estimation</a><ul class="nav-list "><li class="nav-list-item "><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="/Model_Estimation/OLS/OLS.html" class="nav-list-link">Ordinary Least Squares</a><ul class="nav-list"><li class="nav-list-item ">
                        <a href="/Model_Estimation/OLS/simple_linear_regression.html" class="nav-list-link">Simple Linear Regression</a>
                      </li><li class="nav-list-item ">
                        <a href="/Model_Estimation/OLS/stepwise_regression.html" class="nav-list-link">Stepwise Regression</a>
                      </li><li class="nav-list-item ">
                        <a href="/Model_Estimation/OLS/interaction_terms_and_polynomials.html" class="nav-list-link">Interaction Terms and Polynomials</a>
                      </li><li class="nav-list-item ">
                        <a href="/Model_Estimation/OLS/fixed_effects_in_linear_regression.html" class="nav-list-link">Fixed Effects in Linear Regression</a>
                      </li></ul></li><li class="nav-list-item "><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="/Model_Estimation/Matching/matching.html" class="nav-list-link">Matching</a><ul class="nav-list"><li class="nav-list-item ">
                        <a href="/Model_Estimation/Matching/entropy_balancing.html" class="nav-list-link">Entropy Balancing</a>
                      </li><li class="nav-list-item ">
                        <a href="/Model_Estimation/Matching/propensity_score_matching.html" class="nav-list-link">Propensity Score Matching</a>
                      </li></ul></li><li class="nav-list-item "><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="/Model_Estimation/GLS/GLS.html" class="nav-list-link">Generalised Least Squares</a><ul class="nav-list"><li class="nav-list-item ">
                        <a href="/Model_Estimation/GLS/gmm.html" class="nav-list-link">Generalized Method of Moments</a>
                      </li><li class="nav-list-item ">
                        <a href="/Model_Estimation/GLS/heckman_correction_model.html" class="nav-list-link">Heckman Correction Model</a>
                      </li><li class="nav-list-item ">
                        <a href="/Model_Estimation/GLS/logit_model.html" class="nav-list-link">Logit Model</a>
                      </li><li class="nav-list-item ">
                        <a href="/Model_Estimation/GLS/mcfaddens_choice_model.html" class="nav-list-link">McFadden's Choice Model (Alternative-Specific Conditional Logit)</a>
                      </li><li class="nav-list-item ">
                        <a href="/Model_Estimation/GLS/probit_model.html" class="nav-list-link">Probit Model</a>
                      </li><li class="nav-list-item ">
                        <a href="/Model_Estimation/GLS/quantile_regression.html" class="nav-list-link">Quantile Regression</a>
                      </li></ul></li><li class="nav-list-item "><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="/Model_Estimation/Multilevel_Models/Multilevel_Models.html" class="nav-list-link">Multilevel Models</a><ul class="nav-list"><li class="nav-list-item ">
                        <a href="/Model_Estimation/Multilevel_Models/linear_mixed_effects_regression.html" class="nav-list-link">Linear Mixed-Effects Regression</a>
                      </li><li class="nav-list-item ">
                        <a href="/Model_Estimation/Multilevel_Models/mixed_logit.html" class="nav-list-link">Mixed Logit Model</a>
                      </li><li class="nav-list-item ">
                        <a href="/Model_Estimation/Multilevel_Models/random_mixed_effects_estimation.html" class="nav-list-link">Random/Mixed Effects in Linear Regression</a>
                      </li></ul></li><li class="nav-list-item  active"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="/Model_Estimation/Research_Design/Research_Design.html" class="nav-list-link">Research Design</a><ul class="nav-list"><li class="nav-list-item ">
                        <a href="/Model_Estimation/Research_Design/density_discontinuity_test.html" class="nav-list-link">Density Discontinuity Tests for Regression Discontinuity</a>
                      </li><li class="nav-list-item  active">
                        <a href="/Model_Estimation/Research_Design/event_study.html" class="nav-list-link active">Difference in Differences Event Study</a>
                      </li><li class="nav-list-item ">
                        <a href="/Model_Estimation/Research_Design/instrumental_variables.html" class="nav-list-link">Instrumental Variables</a>
                      </li><li class="nav-list-item ">
                        <a href="/Model_Estimation/Research_Design/regression_discontinuity_design.html" class="nav-list-link">Regression Discontinuity Design</a>
                      </li><li class="nav-list-item ">
                        <a href="/Model_Estimation/Research_Design/synthetic_control_method.html" class="nav-list-link">Synthetic Control</a>
                      </li><li class="nav-list-item ">
                        <a href="/Model_Estimation/Research_Design/two_by_two_difference_in_difference.html" class="nav-list-link">2x2 Difference in Difference</a>
                      </li></ul></li><li class="nav-list-item "><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="/Model_Estimation/Statistical_Inference/Statistical_Inference.html" class="nav-list-link">Statistical Inference</a><ul class="nav-list"><li class="nav-list-item ">
                        <a href="/Model_Estimation/Statistical_Inference/linear_hypothesis_tests.html" class="nav-list-link">Linear Hypothesis Tests</a>
                      </li><li class="nav-list-item ">
                        <a href="/Model_Estimation/Statistical_Inference/Nonstandard_Errors/nonstandard_errors.html" class="nav-list-link">Nonstandard Errors</a>
                      </li></ul></li></ul></li><li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="/Presentation/Presentation.html" class="nav-list-link">Presentation</a><ul class="nav-list "><li class="nav-list-item "><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="/Presentation/Figures/Figures.html" class="nav-list-link">Figures</a><ul class="nav-list"><li class="nav-list-item ">
                        <a href="/Presentation/Figures/Scatterplots.html" class="nav-list-link">Scatterplots</a>
                      </li><li class="nav-list-item ">
                        <a href="/Presentation/Figures/Styling_Scatterplots.html" class="nav-list-link">Styling Scatterplots</a>
                      </li><li class="nav-list-item ">
                        <a href="/Presentation/Figures/bar_graphs.html" class="nav-list-link">Bar Graphs</a>
                      </li><li class="nav-list-item ">
                        <a href="/Presentation/Figures/density_plots.html" class="nav-list-link">Density Plots</a>
                      </li><li class="nav-list-item ">
                        <a href="/Presentation/Figures/faceted_graphs.html" class="nav-list-link">Faceted Graphs</a>
                      </li><li class="nav-list-item ">
                        <a href="/Presentation/Figures/graph_themes.html" class="nav-list-link">Graph Themes</a>
                      </li><li class="nav-list-item ">
                        <a href="/Presentation/Figures/heatmap_colored_correlation_matrix.html" class="nav-list-link">Heatmap Colored Correlation Matrix</a>
                      </li><li class="nav-list-item ">
                        <a href="/Presentation/Figures/histograms.html" class="nav-list-link">Histograms</a>
                      </li><li class="nav-list-item ">
                        <a href="/Presentation/Figures/line_graph_with_labels_at_the_beginning_or_end.html" class="nav-list-link">Line Graph with Labels at the Beginning or End of Lines</a>
                      </li><li class="nav-list-item ">
                        <a href="/Presentation/Figures/line_graphs.html" class="nav-list-link">Line Graphs</a>
                      </li><li class="nav-list-item ">
                        <a href="/Presentation/Figures/marginal_effects_plots_for_interactions_with_continuous_variables.html" class="nav-list-link">Marginal Effects Plots for Interactions with Continuous Variables</a>
                      </li><li class="nav-list-item ">
                        <a href="/Presentation/Figures/scatterplot_by_group_on_shared_axes.html" class="nav-list-link">Scatterplot by Group on Shared Axes</a>
                      </li><li class="nav-list-item ">
                        <a href="/Presentation/Figures/styling_line_graphs.html" class="nav-list-link">Styling Line Graphs</a>
                      </li><li class="nav-list-item ">
                        <a href="/Presentation/Figures/summary_graphs.html" class="nav-list-link">Graphing a By-Group or Over-Time Summary Statistic</a>
                      </li><li class="nav-list-item ">
                        <a href="/Presentation/Figures/formatting_graph_legends.html" class="nav-list-link">Formatting Graph Legends</a>
                      </li></ul></li><li class="nav-list-item "><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="/Presentation/Tables/Tables.html" class="nav-list-link">Tables</a><ul class="nav-list"><li class="nav-list-item ">
                        <a href="/Presentation/Tables/Balance_Tables.html" class="nav-list-link">Balance Tables</a>
                      </li><li class="nav-list-item ">
                        <a href="/Presentation/Tables/Correlation_Matrix.html" class="nav-list-link">Correlation Matrix</a>
                      </li><li class="nav-list-item ">
                        <a href="/Presentation/Tables/Cross-Tabulation.html" class="nav-list-link">Cross-Tabulation</a>
                      </li><li class="nav-list-item ">
                        <a href="/Presentation/Tables/Regression_Tables.html" class="nav-list-link">Regression Tables</a>
                      </li><li class="nav-list-item ">
                        <a href="/Presentation/Tables/Summary_Statistics_Tables.html" class="nav-list-link">Summary Statistics Tables</a>
                      </li></ul></li></ul></li><li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="/Time_Series/Time_Series.html" class="nav-list-link">Time Series</a><ul class="nav-list "><li class="nav-list-item "><a href="/Time_Series/AR-models.html" class="nav-list-link">AR Models</a></li><li class="nav-list-item "><a href="/Time_Series/ARCH_Model.html" class="nav-list-link">ARCH Model</a></li><li class="nav-list-item "><a href="/Time_Series/ARIMA-models.html" class="nav-list-link">ARIMA Models</a></li><li class="nav-list-item "><a href="/Time_Series/ARMA-models.html" class="nav-list-link">ARMA Models</a></li><li class="nav-list-item "><a href="/Time_Series/Detecting_Serial_Correlation.html" class="nav-list-link">Autocorrelation Function</a></li><li class="nav-list-item "><a href="/Time_Series/GARCH_Model.html" class="nav-list-link">GARCH Model</a></li><li class="nav-list-item "><a href="/Time_Series/Granger_Causality.html" class="nav-list-link">Granger Causality</a></li><li class="nav-list-item "><a href="/Time_Series/MA_Model.html" class="nav-list-link">MA Models</a></li><li class="nav-list-item "><a href="/Time_Series/Rolling_Regression.html" class="nav-list-link">Rolling Regression</a></li><li class="nav-list-item "><a href="/Time_Series/State_Space_Models.html" class="nav-list-link">State Space Models</a></li><li class="nav-list-item "><a href="/Time_Series/creating_time_series_dataset.html" class="nav-list-link">Creating Time Series Dataset</a></li></ul></li><li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="/Other/Other.html" class="nav-list-link">Other</a><ul class="nav-list "><li class="nav-list-item "><a href="/Other/create_a_conda_package.html" class="nav-list-link">Create a Conda Package (Python)</a></li><li class="nav-list-item "><a href="/Other/get_a_list_of_files.html" class="nav-list-link">Get a List of Files</a></li><li class="nav-list-item "><a href="/Other/import_a_foreign_data_file.html" class="nav-list-link">Import a Foreign Data File</a></li><li class="nav-list-item "><a href="/Other/importing_delimited_files.html" class="nav-list-link">Import a Delimited Data File (CSV, TSV)</a></li><li class="nav-list-item "><a href="/Other/set_a_working_directory.html" class="nav-list-link">Set a Working Directory</a></li><li class="nav-list-item "><a href="/Other/simple_web_scrape.html" class="nav-list-link">Simple Web Scraping</a></li><li class="nav-list-item "><a href="/Other/task_scheduling_with_github_actions.html" class="nav-list-link">Task Scheduling with Github Actions</a></li></ul></li><li class="nav-list-item"><a href="/Desired_Nonexistent_Pages/desired_nonexistent_pages.html" class="nav-list-link">Desired Nonexistent Pages</a></li><li class="nav-list-item"><a href="/Contributing/Contributing.html" class="nav-list-link">Contributing</a></li><li class="nav-list-item"><a href="/" class="nav-list-link">Home</a></li></ul>
    </nav>
    <footer class="site-footer">
      This site uses <a href="https://github.com/pmarsceill/just-the-docs">Just the Docs</a>, a documentation theme for Jekyll.
    </footer>
  </div>
  <div class="main" id="top">
    <div id="main-header" class="main-header">
        <div class="search">
          <div class="search-input-wrap">
            <input type="text" id="search-input" class="search-input" tabindex="0" placeholder="Search LOST" aria-label="Search LOST" autocomplete="off">
            <label for="search-input" class="search-label"><svg viewBox="0 0 24 24" class="search-icon"><use xlink:href="#svg-search"></use></svg></label>
          </div>
          <div id="search-results" class="search-results"></div>
        </div>
    </div>
    <div id="main-content-wrap" class="main-content-wrap">
          <nav aria-label="Breadcrumb" class="breadcrumb-nav">
            <ol class="breadcrumb-nav-list">
                <li class="breadcrumb-nav-list-item"><a href="/Model_Estimation/Model_Estimation.html">Model Estimation</a></li>
                <li class="breadcrumb-nav-list-item"><a href="/Model_Estimation/Research_Design/Research_Design.html">Research Design</a></li>
              <li class="breadcrumb-nav-list-item"><span>Difference in Differences Event Study</span></li>
            </ol>
          </nav>
      <div id="main-content" class="main-content" role="main">
          <h1 id="difference-in-differences-event-study--dynamic-difference-in-differences">
          <a href="#difference-in-differences-event-study--dynamic-difference-in-differences" aria-labelledby="difference-in-differences-event-study--dynamic-difference-in-differences" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Difference-in-Differences Event Study / Dynamic Difference-in-Differences
      </h1>
<p>A Difference-in-Difference (DID) event study, or a Dynamic DID model, is a useful tool in evaluating treatment effects of the pre- and post- treatment periods in your respective study. However, since treatment can be staggered - where the treatment group are treated at different time periods - it might be challenging to create a clean event study.</p>
<p>In the following code, we will learn how to create a DID event study when treatment is staggered. If there is only one treatment period, the same methodology as described below can be applied.</p>
<p><strong>Importantly</strong>, while this page uses data from a staggered-treatment design, <a href="https://www.sciencedirect.com/science/article/pii/S030440762030378X">Sun and Abraham (2020)</a> showed that basic event-study estimation can be biased in this setup. The code below should be used only in cases where treatment occurs at a single time period. Where possible, the code will also show how to apply the Sun and Abraham estimator that fixes this problem.</p>
<p>The regression that DID event studies are based aroud is:</p>
\[Y_{gt} = \alpha + \Sigma_{k=T_0}^{-2}\beta_k\times treat_{gk}+\Sigma_{k=0}^{T_1}\beta_k\times treat_{gk}+ X_{st}\Gamma+\phi_s+\gamma_t+\epsilon_{st}\]
<p>Where:</p>
<ul>
  <li>
    <p>\(treat_{sk}\) is a dummy variable, equaling 1 if the observation’s periods relative to the group \(g\)’s first treated period is the same value as <code class="language-plaintext highlighter-rouge">k</code>; 0 otherwise (and 0 for all never-treated groups).</p>
  </li>
  <li>
    <p>\(T_0\) and \(T_1\) are the lowest and highest number of leads and lags to consider surrouning the treatment period, respectively.</p>
  </li>
  <li>
    <p>\(X`\) are controls</p>
  </li>
  <li>
    <p>\(\phi\) and \(\gamma\) are state and time fixed effects</p>
  </li>
  <li>
    <p>Estimation is generally performed with standard errors clustered at the group level</p>
  </li>
</ul>
<p>Important notes on the regression:</p>
<ul>
  <li>
    <p>The point of the regression is to show for each period before and after treatment that the coefficients on the pre-treated periods are statistically insignificant</p>
  </li>
  <li>
    <p>Showing the control and treated groups are statistically the same before treatment (\(\beta_k=0\) for \(k &lt; 0\)) supports, though does not prove, the parallel trends assumption in DID estimation.</p>
  </li>
  <li>
    <p>One of the time periods must be dropped to avoid perfect multicollinearity (as in most fixed-effects setups). In most event studies, the -1 time lag is used as the dropped reference.</p>
  </li>
</ul>
      <h2 id="keep-in-mind">
          <a href="#keep-in-mind" aria-labelledby="keep-in-mind" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Keep in Mind
      </h2>
<p>Mechanically, an event study is a graphical illustration of the point estimates and confidence intervals of the regression for each time period before and after the treatment period. It’s especially relevant in the DID environment as the point estimates are the average mean differences between the treated and control groups, which provides further evidence of the credibility in assuming parallel trends.</p>
      <h2 id="also-consider">
          <a href="#also-consider" aria-labelledby="also-consider" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Also Consider
      </h2>
<ul>
  <li><a href="/Model_Estimation/Research_Design/two_by_two_difference_in_difference.html">2x2 Difference-in-Differences</a></li>
  <li>A great resource for learning more about DID and event study theory is at <a href="https://mixtape.scunning.com/difference-in-differences.html#providing-evidence-for-parallel-trends-through-event-studies-and-parallel-leads">Causal Inference: The Mixtape</a>.</li>
</ul>
      <h1 id="implementations">
          <a href="#implementations" aria-labelledby="implementations" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Implementations
      </h1>
<p>All implementations use the same data, which comes from <a href="http://users.nber.org/~jwolfers/papers/bargaining_in_the_shadow_of_the_law.pdf">Stevenson and Wolfers (2006)</a> by way of <a href="http://ftp.iza.org/dp13524.pdf">Clarke &amp; Schythe (2020)</a>, who use it as an example to demonstrate Goodman-Bacon effects. This data is a balanced panel from 1964 through 1996 of the United States no-fault divorce reforms and female suicide rates. You can directly download the data <a href="http://www.damianclarke.net/stata/bacon_example.dta">here</a>.</p>
<p>Column <code class="language-plaintext highlighter-rouge">_nfd</code> in the data  specifies the year in which the law went into effect for the respective state. We use this column to identify the lead and lags with respect to year of treatment. <code class="language-plaintext highlighter-rouge">pcinc</code>, <code class="language-plaintext highlighter-rouge">asmrh</code>, and <code class="language-plaintext highlighter-rouge">cases</code> are controls.</p>
<p>Note that there are some states in which <code class="language-plaintext highlighter-rouge">_nfd</code> is empty. These states never received treatment, and thus exist as a control.</p>
      <h2 id="python">
          <a href="#python" aria-labelledby="python" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Python
      </h2>
<p>Python makes dealing with lots of interaction terms like we have here a little painful, but we can iterate to do a lot of the work for us.</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="n">pd</span>
<span class="kn">import</span> <span class="nn">linearmodels</span> <span class="k">as</span> <span class="n">lm</span>

<span class="c1"># Read in data
</span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">read_stata</span><span class="p">(</span><span class="s">"https://raw.githubusercontent.com/LOST-STATS/LOST-STATS.github.io/master/Model_Estimation/Data/Event_Study_DiD/bacon_example.dta"</span><span class="p">)</span>

<span class="c1"># create the lag/lead for treated states
# fill in control obs with 0
# This allows for the interaction between `treat` and `time_to_treat` to occur for each state.
# Otherwise, there may be some missingss and the estimations will be off.
</span><span class="n">df</span><span class="p">[</span><span class="s">'time_to_treat'</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">df</span><span class="p">[</span><span class="s">'_nfd'</span><span class="p">].</span><span class="n">sub</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s">'year'</span><span class="p">])</span>
        <span class="c1"># missing values for _nfd implies no treatment
</span>        <span class="p">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="c1"># so we don't have decimals in our factor names
</span>        <span class="p">.</span><span class="n">astype</span><span class="p">(</span><span class="s">'int'</span><span class="p">)</span>
<span class="p">)</span>

<span class="c1"># Create our interactions by hand,
# skipping -1, the last one before treatment
</span>
<span class="n">df</span> <span class="o">=</span> <span class="p">(</span>
    <span class="c1"># returns dataframe with dummy columns in place of the columns
</span>    <span class="c1"># in the named argument, all other columns untouched
</span>    <span class="n">pd</span><span class="p">.</span><span class="n">get_dummies</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s">'time_to_treat'</span><span class="p">],</span> <span class="n">prefix</span><span class="o">=</span><span class="s">'INX'</span><span class="p">)</span>
      <span class="c1"># Be sure not to include the minuses in the name
</span>      <span class="p">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">.</span><span class="n">replace</span><span class="p">(</span><span class="s">'-'</span><span class="p">,</span> <span class="s">'m'</span><span class="p">))</span>
      <span class="c1"># get_dummies has a `drop_first` argument, but if we want to
</span>      <span class="c1"># refer to a specific level, we should return all levels and
</span>      <span class="c1"># drop out reference column manually
</span>      <span class="p">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="s">'INX_m1'</span><span class="p">)</span>
      <span class="c1"># Set our individual and time (index) for our data
</span>      <span class="p">.</span><span class="n">set_index</span><span class="p">([</span><span class="s">'stfips'</span><span class="p">,</span> <span class="s">'year'</span><span class="p">])</span>
<span class="p">)</span>

<span class="c1"># Estimate the regression
</span>
<span class="n">scalars</span> <span class="o">=</span> <span class="p">[</span><span class="s">'pcinc'</span><span class="p">,</span> <span class="s">'asmrh'</span><span class="p">,</span> <span class="s">'cases'</span><span class="p">]</span>
<span class="n">factors</span> <span class="o">=</span> <span class="n">df</span><span class="p">.</span><span class="n">columns</span><span class="p">[</span><span class="n">df</span><span class="p">.</span><span class="n">columns</span><span class="p">.</span><span class="nb">str</span><span class="p">.</span><span class="n">contains</span><span class="p">(</span><span class="s">'INX'</span><span class="p">)]</span>
<span class="n">exog</span> <span class="o">=</span> <span class="n">factors</span><span class="p">.</span><span class="n">union</span><span class="p">(</span><span class="n">scalars</span><span class="p">)</span>
<span class="n">endog</span> <span class="o">=</span> <span class="s">'asmrs'</span>

<span class="c1"># with the standard api:
</span><span class="n">mod</span> <span class="o">=</span> <span class="n">lm</span><span class="p">.</span><span class="n">PanelOLS</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">endog</span><span class="p">],</span> <span class="n">df</span><span class="p">[</span><span class="n">exog</span><span class="p">],</span> <span class="n">entity_effects</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">time_effects</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="n">fit</span> <span class="o">=</span> <span class="n">mod</span><span class="p">.</span><span class="n">fit</span><span class="p">(</span><span class="n">cov_type</span><span class="o">=</span><span class="s">'clustered'</span><span class="p">,</span> <span class="n">cluster_entity</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="n">fit</span><span class="p">.</span><span class="n">summary</span>

<span class="c1"># with the formula api:
# We can save ourselves some time by creating the regression formula automatically
</span><span class="n">inxnames</span> <span class="o">=</span> <span class="n">df</span><span class="p">.</span><span class="n">columns</span><span class="p">[</span><span class="nb">range</span><span class="p">(</span><span class="mi">13</span><span class="p">,</span><span class="n">df</span><span class="p">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])]</span>
<span class="n">formula</span> <span class="o">=</span> <span class="s">'{} ~ {} + EntityEffects + TimeEffects'</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">endog</span><span class="p">,</span> <span class="s">'+'</span><span class="p">.</span><span class="n">join</span><span class="p">(</span><span class="n">exog</span><span class="p">))</span>

<span class="n">mod</span> <span class="o">=</span> <span class="n">lm</span><span class="p">.</span><span class="n">PanelOLS</span><span class="p">.</span><span class="n">from_formula</span><span class="p">(</span><span class="n">formula</span><span class="p">,</span><span class="n">df</span><span class="p">)</span>

<span class="c1"># Specify clustering when we fit the model
</span><span class="n">clfe</span> <span class="o">=</span> <span class="n">mod</span><span class="p">.</span><span class="n">fit</span><span class="p">(</span><span class="n">cov_type</span> <span class="o">=</span> <span class="s">'clustered'</span><span class="p">,</span>
    <span class="n">cluster_entity</span> <span class="o">=</span> <span class="bp">True</span><span class="p">)</span>

<span class="c1"># Look at regression results
</span><span class="n">clfe</span><span class="p">.</span><span class="n">summary</span>
</code></pre></div></div>
<p>Now we can plot the results with <strong>matplotlib</strong>. Two common approaches are to include vertical-line confidence intervals with <code class="language-plaintext highlighter-rouge">errorbar()</code> or to include a confidence interval ribbon with <code class="language-plaintext highlighter-rouge">fill_between()</code>. I’ll show the <code class="language-plaintext highlighter-rouge">errorbar()</code> version.</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Get coefficients and CIs
</span><span class="n">res</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">concat</span><span class="p">([</span><span class="n">clfe</span><span class="p">.</span><span class="n">params</span><span class="p">,</span> <span class="n">clfe</span><span class="p">.</span><span class="n">std_errors</span><span class="p">],</span> <span class="n">axis</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
<span class="c1"># Scale standard error to 95% CI
</span><span class="n">res</span><span class="p">[</span><span class="s">'ci'</span><span class="p">]</span> <span class="o">=</span> <span class="n">res</span><span class="p">[</span><span class="s">'std_error'</span><span class="p">]</span><span class="o">*</span><span class="mf">1.96</span>

<span class="c1"># We only want time interactions
</span><span class="n">res</span> <span class="o">=</span> <span class="n">res</span><span class="p">.</span><span class="nb">filter</span><span class="p">(</span><span class="n">like</span><span class="o">=</span><span class="s">'INX'</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="c1"># Turn the coefficient names back to numbers
</span><span class="n">res</span><span class="p">.</span><span class="n">index</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">res</span><span class="p">.</span><span class="n">index</span>
        <span class="p">.</span><span class="nb">str</span><span class="p">.</span><span class="n">replace</span><span class="p">(</span><span class="s">'INX_'</span><span class="p">,</span> <span class="s">''</span><span class="p">)</span>
        <span class="p">.</span><span class="nb">str</span><span class="p">.</span><span class="n">replace</span><span class="p">(</span><span class="s">'m'</span><span class="p">,</span> <span class="s">'-'</span><span class="p">)</span>
        <span class="p">.</span><span class="n">astype</span><span class="p">(</span><span class="s">'int'</span><span class="p">)</span>
        <span class="p">.</span><span class="n">rename</span><span class="p">(</span><span class="s">'time_to_treat'</span><span class="p">)</span>
<span class="p">)</span>

<span class="c1"># And add our reference period back in, and sort automatically
</span><span class="n">res</span><span class="p">.</span><span class="n">reindex</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">res</span><span class="p">.</span><span class="n">index</span><span class="p">.</span><span class="nb">min</span><span class="p">(),</span> <span class="n">res</span><span class="p">.</span><span class="n">index</span><span class="p">.</span><span class="nb">max</span><span class="p">()</span><span class="o">+</span><span class="mi">1</span><span class="p">)).</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

<span class="c1"># Plot the estimates as connected lines with error bars
</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">res</span><span class="p">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">y</span><span class="o">=</span><span class="s">'parameter'</span><span class="p">,</span>
    <span class="n">yerr</span><span class="o">=</span><span class="s">'ci'</span><span class="p">,</span>
    <span class="n">xlabel</span><span class="o">=</span><span class="s">'Time to Treatment'</span><span class="p">,</span>
    <span class="n">ylabel</span><span class="o">=</span><span class="s">'Estimated Effect'</span><span class="p">,</span>
    <span class="n">legend</span><span class="o">=</span><span class="bp">False</span>
<span class="p">)</span>
<span class="c1"># Add a horizontal line at 0
</span><span class="n">ax</span><span class="p">.</span><span class="n">axhline</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s">'dashed'</span><span class="p">)</span>
<span class="c1"># And a vertical line at the treatment time
# some versions of pandas have bug return x-axis object with data_interval
# starting at 0. In that case change 0 to 21
</span><span class="n">ax</span><span class="p">.</span><span class="n">axvline</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s">'dashed'</span><span class="p">)</span>
</code></pre></div></div>
<p>Which produces:</p>
<p><img src="/Model_Estimation/Images/Event_Study/py_did_event_study.png" alt="DID Event Study Graph in Python" /></p>
<p>Of course, as earlier mentioned, this analysis is subject to the critique by Sun and Abraham (2020). You want to calculate effects separately by time-when-treated, and then aggregate to the time-to-treatment level properly, avoiding the way these estimates can “contaminate” each other in the regular model. You are on your own for this process in Python, though. Read the paper (and the back-end code from the R or Stata implementations listed below).</p>
      <h2 id="r">
          <a href="#r" aria-labelledby="r" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> R
      </h2>
<p>First, load packages and the data</p>
<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">library</span><span class="p">(</span><span class="n">dplyr</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">fixest</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">tidyverse</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">broom</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">haven</span><span class="p">)</span><span class="w">

</span><span class="c1">#Load and prepare data</span><span class="w">
</span><span class="n">bacon_df</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">read_dta</span><span class="p">(</span><span class="s2">"https://raw.githubusercontent.com/LOST-STATS/LOST-STATS.github.io/master/Model_Estimation/Data/Event_Study_DiD/bacon_example.dta"</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">mutate</span><span class="p">(</span><span class="w">
  </span><span class="c1"># create the lag/lead for treated states</span><span class="w">
  </span><span class="c1"># fill in control obs with 0</span><span class="w">
  </span><span class="c1"># This allows for the interaction between `treat` and `time_to_treat` to occur for each state.</span><span class="w">
  </span><span class="c1"># Otherwise, there may be some NAs and the estimations will be off.</span><span class="w">
  </span><span class="n">time_to_treat</span><span class="w"> </span><span class="o">=</span><span class="n">ifelse</span><span class="p">(</span><span class="nf">is.na</span><span class="p">(</span><span class="n">`_nfd`</span><span class="p">),</span><span class="m">0</span><span class="p">,</span><span class="n">year</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">`_nfd`</span><span class="p">),</span><span class="w">
  </span><span class="c1"># this will determine the difference</span><span class="w">
  </span><span class="c1"># btw controls and treated states</span><span class="w">
  </span><span class="n">treat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ifelse</span><span class="p">(</span><span class="nf">is.na</span><span class="p">(</span><span class="n">`_nfd`</span><span class="p">),</span><span class="m">0</span><span class="p">,</span><span class="m">1</span><span class="p">)</span><span class="w">
  </span><span class="p">)</span><span class="w">
</span></code></pre></div></div>
<p>Also, while it’s not necessary given how we’re about to use the <strong>fixest</strong> package, if you’re interested in creating a dummy variable for each lead/lag in your data set, you can use the package <strong>fastDummies</strong> and <code class="language-plaintext highlighter-rouge">bacon_df &lt;- dummy_cols(bacon_df, select_column = "time_to_treat")</code>.</p>
<p>We will run the event-study regression using <code class="language-plaintext highlighter-rouge">feols()</code> from the <strong>fixest</strong> package. <strong>fixest</strong> is very fast, contains support for complex fixed-effects interactions, selecting our own reference group like we need with <code class="language-plaintext highlighter-rouge">i()</code>, and will also help run the Sun and Abraham (2020) estimator.</p>
<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">m_1</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">feols</span><span class="p">(</span><span class="n">asmrs</span><span class="w"> </span><span class="o">~</span><span class="w">
    </span><span class="c1"># The time-treatment interaction terms</span><span class="w">
	</span><span class="n">i</span><span class="p">(</span><span class="n">treat</span><span class="p">,</span><span class="w"> </span><span class="n">time_to_treat</span><span class="p">,</span><span class="w"> </span><span class="n">ref</span><span class="o">=</span><span class="m">-1</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
	</span><span class="c1"># Controls</span><span class="w">
	</span><span class="n">pcinc</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">asmrh</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">cases</span><span class="w">
	</span><span class="c1"># State and year fixed effects</span><span class="w">
	</span><span class="o">|</span><span class="w"> </span><span class="n">stfips</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">year</span><span class="p">,</span><span class="w">
	</span><span class="c1"># feols clusters by the first fixed effect anyway, just making that clear</span><span class="w">
	</span><span class="n">cluster</span><span class="o">=~</span><span class="n">stfips</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="o">=</span><span class="n">bacon_df</span><span class="p">)</span><span class="w">
</span><span class="c1"># Now turn the results into a data frame with a year column for easy plotting</span><span class="w">
</span><span class="n">event_1</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">tidy</span><span class="p">(</span><span class="n">m_1</span><span class="p">,</span><span class="w"> </span><span class="n">conf.int</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
	</span><span class="c1"># For plotting purposes, we only want the terms that reference years</span><span class="w">
	</span><span class="c1"># and not the controls</span><span class="w">
    </span><span class="n">mutate</span><span class="p">(</span><span class="n">year</span><span class="w"> </span><span class="o">=</span><span class="w">  </span><span class="nf">as.numeric</span><span class="p">(</span><span class="n">parse_number</span><span class="p">(</span><span class="n">term</span><span class="p">)))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
	</span><span class="n">filter</span><span class="p">(</span><span class="o">!</span><span class="nf">is.na</span><span class="p">(</span><span class="n">year</span><span class="p">))</span><span class="w">
</span></code></pre></div></div>
<p>Now we can plot the results with <strong>ggplot2</strong>. Two common approaches are to include vertical-line confidence intervals with <code class="language-plaintext highlighter-rouge">geom_pointrange()</code> or to include a confidence interval ribbon with <code class="language-plaintext highlighter-rouge">geom_ribbon()</code>. I’ll show the <code class="language-plaintext highlighter-rouge">geom_pointrange()</code> version, but this is easy to swap out.</p>
<p>Now, you could just simply use <code class="language-plaintext highlighter-rouge">coefplot(m_1)</code> from <strong>fixest</strong> and be done with it! This will create the event-study plot for you. Done. But if you want to maybe do some <strong>ggplot2</strong> styling afterwards, or do some by-hand tweaks, you can do it yourself:</p>
<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">event_1</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">ggplot</span><span class="p">(</span><span class="w">
    </span><span class="n">mapping</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="w">
      </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">year</span><span class="p">,</span><span class="w">
      </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">estimate</span><span class="p">,</span><span class="w">
	    </span><span class="n">ymin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">conf.low</span><span class="p">,</span><span class="w">
      </span><span class="n">ymax</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">conf.high</span><span class="w">
    </span><span class="p">)</span><span class="w">
  </span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">geom_pointrange</span><span class="p">(</span><span class="w">
    </span><span class="n">position</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">position_dodge</span><span class="p">(</span><span class="n">width</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">),</span><span class="w">

    </span><span class="c1"># Optional decoration:</span><span class="w">
	  </span><span class="n">color</span><span class="o">=</span><span class="s2">"black"</span><span class="p">,</span><span class="w">
    </span><span class="n">fatten</span><span class="o">=</span><span class="m">.5</span><span class="p">,</span><span class="w">
    </span><span class="n">alpha</span><span class="o">=</span><span class="m">.8</span><span class="w">
  </span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">

  </span><span class="c1"># Add a line marker for y = 0 (to see if the CI overlaps 0)</span><span class="w">
  </span><span class="n">geom_hline</span><span class="p">(</span><span class="n">yintercept</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="n">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"red"</span><span class="p">,</span><span class="w"> </span><span class="n">alpha</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.2</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">

  </span><span class="c1"># A marker for the last pre-event period</span><span class="w">
  </span><span class="n">geom_vline</span><span class="p">(</span><span class="n">xintercept</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">-1</span><span class="p">,</span><span class="w"> </span><span class="n">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"black"</span><span class="p">,</span><span class="w"> </span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.5</span><span class="p">,</span><span class="w"> </span><span class="n">alpha</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.4</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">

  </span><span class="c1"># And the event period</span><span class="w">
  </span><span class="n">geom_vline</span><span class="p">(</span><span class="n">xintercept</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="n">linetype</span><span class="o">=</span><span class="s2">"dotted"</span><span class="p">,</span><span class="w"> </span><span class="n">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"black"</span><span class="p">,</span><span class="w"> </span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.5</span><span class="p">,</span><span class="w"> </span><span class="n">alpha</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.2</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">

  </span><span class="c1"># Additional decoration:</span><span class="w">
  </span><span class="n">theme_bw</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">theme</span><span class="p">(</span><span class="w">
    </span><span class="n">plot.title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">element_text</span><span class="p">(</span><span class="n">face</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"bold"</span><span class="p">,</span><span class="w"> </span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">12</span><span class="p">),</span><span class="w">
	  </span><span class="n">legend.background</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">element_rect</span><span class="p">(</span><span class="n">fill</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"white"</span><span class="p">,</span><span class="w"> </span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">4</span><span class="p">,</span><span class="w"> </span><span class="n">colour</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"white"</span><span class="p">),</span><span class="w">
	  </span><span class="n">legend.justification</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">),</span><span class="w">
	  </span><span class="n">legend.position</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">),</span><span class="w">
	  </span><span class="n">axis.ticks</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">element_line</span><span class="p">(</span><span class="n">colour</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"white"</span><span class="p">,</span><span class="w"> </span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.1</span><span class="p">),</span><span class="w">
	  </span><span class="n">panel.grid.major</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">element_line</span><span class="p">(</span><span class="n">colour</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"white"</span><span class="p">,</span><span class="w"> </span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.07</span><span class="p">),</span><span class="w">
	  </span><span class="n">panel.grid.minor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">element_blank</span><span class="p">()</span><span class="w">
	</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">annotate</span><span class="p">(</span><span class="s2">"text"</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="m">2</span><span class="p">),</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">30</span><span class="p">,</span><span class="w"> </span><span class="n">label</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">""</span><span class="p">,</span><span class="w"> </span><span class="s2">"treat"</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
	</span><span class="n">labs</span><span class="p">(</span><span class="n">title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Event Study: Staggered Treatment"</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Estimate"</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Time"</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>
<p>This results in:</p>
<p><img src="/Model_Estimation/Images/Event_Study/event1.png" alt="DID Event Study Graph in R" /></p>
<p>Another common option in these graphs is to link all the individual point estimates with a line. This can be done by adding <code class="language-plaintext highlighter-rouge">+geom_line()</code> right after the <code class="language-plaintext highlighter-rouge">geom_pointrange()</code> call.</p>
<p>Of course, as earlier mentioned, this analysis is subject to the critique by Sun and Abraham (2020). We can also use <strong>fixest</strong> to estimate the Sun and Abraham estimator to calculate effects separately by time-when-treated, and then aggregate to the time-to-treatment level properly, avoiding the way these estimates can “contaminate” each other in the regular model.</p>
<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># see help(aggregate.fixest)</span><span class="w">
</span><span class="c1"># As Sun and Abraham indicate, drop any always-treated groups</span><span class="w">
</span><span class="n">sun_df</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">bacon_df</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">filter</span><span class="p">(</span><span class="n">`_nfd`</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="nf">min</span><span class="p">(</span><span class="n">year</span><span class="p">)</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="o">!</span><span class="n">treat</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="c1"># and set time_to_treat to -1000 for untreated groups</span><span class="w">
  </span><span class="n">mutate</span><span class="p">(</span><span class="n">time_to_treat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">case_when</span><span class="p">(</span><span class="w">
    </span><span class="n">treat</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="m">-1000</span><span class="p">,</span><span class="w">
    </span><span class="n">treat</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">time_to_treat</span><span class="w">
  </span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="c1"># and create a new year-treated variable that's impossibly far in the future</span><span class="w">
  </span><span class="c1"># for untreated groups</span><span class="w">
  </span><span class="n">mutate</span><span class="p">(</span><span class="n">year_treated</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">case_when</span><span class="p">(</span><span class="w">
    </span><span class="n">treat</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="m">10000</span><span class="p">,</span><span class="w">
    </span><span class="n">treat</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">`_nfd`</span><span class="w">
  </span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="c1"># and a shared identifier for year treated and year</span><span class="w">
  </span><span class="n">mutate</span><span class="p">(</span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">paste0</span><span class="p">(</span><span class="n">year_treated</span><span class="p">,</span><span class="w"> </span><span class="s1">':'</span><span class="p">,</span><span class="w"> </span><span class="n">year</span><span class="p">))</span><span class="w">

</span><span class="c1"># Don't include so many pre- and post-lags that you've got a lot of tiny periods</span><span class="w">
</span><span class="n">table</span><span class="p">(</span><span class="n">sun_df</span><span class="o">$</span><span class="n">time_to_treat</span><span class="p">)</span><span class="w">
</span><span class="n">sun_df</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">sun_df</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">filter</span><span class="p">(</span><span class="n">time_to_treat</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">-1000</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="p">(</span><span class="n">time_to_treat</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="m">-9</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">time_to_treat</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="m">24</span><span class="p">))</span><span class="w">

</span><span class="c1"># Read the Sun and Abraham paper before including controls as I do here</span><span class="w">
</span><span class="n">m_2</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">feols</span><span class="p">(</span><span class="n">asmrs</span><span class="w"> </span><span class="o">~</span><span class="w">
               </span><span class="c1"># This time, interact time_to_treatment with year treated</span><span class="w">
               </span><span class="c1"># Dropping as reference the -1 period and the never-treated</span><span class="w">
               </span><span class="n">i</span><span class="p">(</span><span class="n">time_to_treat</span><span class="p">,</span><span class="w"> </span><span class="n">f2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">year_treated</span><span class="p">,</span><span class="w"> </span><span class="n">drop</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">-1</span><span class="p">,</span><span class="w"> </span><span class="m">-1000</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
               </span><span class="c1"># Controls</span><span class="w">
               </span><span class="n">pcinc</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">asmrh</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">cases</span><span class="w">
             </span><span class="c1"># Fixed effects for group and year</span><span class="w">
             </span><span class="o">|</span><span class="w"> </span><span class="n">stfips</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">year</span><span class="p">,</span><span class="w">
             </span><span class="n">data</span><span class="o">=</span><span class="n">sun_df</span><span class="p">)</span><span class="w">
</span><span class="c1"># Aggregate the coefficients by group</span><span class="w">
</span><span class="n">agg_coef</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">aggregate</span><span class="p">(</span><span class="n">m_2</span><span class="p">,</span><span class="w"> </span><span class="s2">"(time_to_treat)::(-?[[:digit:]]+)"</span><span class="p">)</span><span class="w">
</span><span class="c1"># And plot</span><span class="w">
</span><span class="n">agg_coef</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">as_tibble</span><span class="p">()</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">mutate</span><span class="p">(</span><span class="n">conf.low</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Estimate</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="m">1.96</span><span class="o">*</span><span class="n">`Std. Error`</span><span class="p">,</span><span class="w">
         </span><span class="n">conf.high</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Estimate</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="m">1.96</span><span class="o">*</span><span class="n">`Std. Error`</span><span class="p">,</span><span class="w">
         </span><span class="n">`Time to Treatment`</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">-9</span><span class="o">:</span><span class="m">-2</span><span class="p">,</span><span class="w"> </span><span class="m">0</span><span class="o">:</span><span class="m">24</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">ggplot</span><span class="p">(</span><span class="n">mapping</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">`Time to Treatment`</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Estimate</span><span class="p">,</span><span class="w">
                       </span><span class="n">ymin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">conf.low</span><span class="p">,</span><span class="w"> </span><span class="n">ymax</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">conf.high</span><span class="p">))</span><span class="o">+</span><span class="w">
  </span><span class="n">geom_pointrange</span><span class="p">(</span><span class="n">position</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">position_dodge</span><span class="p">(</span><span class="n">width</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">),</span><span class="w">
                  </span><span class="c1"># Optional decoration:</span><span class="w">
                  </span><span class="n">color</span><span class="o">=</span><span class="s2">"black"</span><span class="p">,</span><span class="w"> </span><span class="n">fatten</span><span class="o">=</span><span class="m">.5</span><span class="p">,</span><span class="w"> </span><span class="n">alpha</span><span class="o">=</span><span class="m">.8</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">geom_line</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="c1"># Add a line marker for y = 0 (to see if the CI overlaps 0)</span><span class="w">
  </span><span class="n">geom_hline</span><span class="p">(</span><span class="n">yintercept</span><span class="o">=</span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="n">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"red"</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="m">0.2</span><span class="p">)</span><span class="o">+</span><span class="w">
  </span><span class="c1"># A marker for the last pre-event period</span><span class="w">
  </span><span class="n">geom_vline</span><span class="p">(</span><span class="n">xintercept</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">-1</span><span class="p">,</span><span class="w"> </span><span class="n">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"black"</span><span class="p">,</span><span class="w"> </span><span class="n">size</span><span class="o">=</span><span class="m">0.5</span><span class="p">,</span><span class="w"> </span><span class="n">alpha</span><span class="o">=</span><span class="m">0.4</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="c1"># And the event period</span><span class="w">
  </span><span class="n">geom_vline</span><span class="p">(</span><span class="n">xintercept</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="n">linetype</span><span class="o">=</span><span class="s2">"dotted"</span><span class="p">,</span><span class="w"> </span><span class="n">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"black"</span><span class="p">,</span><span class="w"> </span><span class="n">size</span><span class="o">=</span><span class="m">0.5</span><span class="p">,</span><span class="w"> </span><span class="n">alpha</span><span class="o">=</span><span class="m">0.2</span><span class="p">)</span><span class="o">+</span><span class="w">
  </span><span class="c1"># Additional decoration:</span><span class="w">
  </span><span class="n">theme_bw</span><span class="p">()</span><span class="o">+</span><span class="w">
  </span><span class="n">labs</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">"Event Study: Staggered Treatment with Sun and Abraham (2020) Estimation"</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="s2">"Estimate"</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="o">=</span><span class="s2">"Time"</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>
      <h2 id="stata">
          <a href="#stata" aria-labelledby="stata" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Stata
      </h2>
<p>We can use the <strong>reghdfe</strong> package to help with our two-way fixed effects and high-dimensional data. Install with <code class="language-plaintext highlighter-rouge">ssc install reghdfe</code> first if you don’t have it.</p>
<div class="language-stata highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">use</span> <span class="s2">"https://raw.githubusercontent.com/LOST-STATS/LOST-STATS.github.io/master/Model_Estimation/Data/Event_Study_DiD/bacon_example.dta"</span><span class="err">,</span> <span class="err">clear
</span><span class="c1">
* create the lag/lead for treated states
* fill in control obs with 0
* This allows for the interaction between `treat` and `time_to_treat` to occur for each state.
* Otherwise, there may be some NAs and the estimations will be off.
</span><span class="err">g</span> <span class="err">time_to_treat</span> <span class="o">=</span> <span class="err">year</span> <span class="o">-</span> <span class="err">_nfd
replace</span> <span class="err">time_to_treat</span> <span class="o">=</span> <span class="err">0</span> <span class="err">if</span> <span class="err">missing(_nfd)
</span><span class="c1">* this will determine the difference
* btw controls and treated states
</span><span class="err">g</span> <span class="err">treat</span> <span class="o">=</span> <span class="o">!</span><span class="err">missing(_nfd)
</span><span class="c1">
* Stata won't allow factors with negative values, so let's shift
* time-to-treat to start at 0, keeping track of where the true -1 is
</span><span class="err">summ</span> <span class="err">time_to_treat
g</span> <span class="err">shifted_ttt</span> <span class="o">=</span> <span class="err">time_to_treat</span> <span class="o">-</span> <span class="err">r(min)
summ</span> <span class="err">shifted_ttt</span> <span class="err">if</span> <span class="err">time_to_treat</span> <span class="o">==</span> <span class="o">-</span><span class="err">1
local</span> <span class="err">true_neg1</span> <span class="o">=</span> <span class="err">r(mean)
</span><span class="c1">
* Regress on our interaction terms with FEs for group and year,
* clustering at the group (state) level
* use ib# to specify our reference group
</span><span class="err">reghdfe</span> <span class="err">asmrs</span> <span class="err">ib</span><span class="p">`</span><span class="si">true_neg1</span><span class="p">'</span><span class="err">.shifted_ttt</span> <span class="err">pcinc</span> <span class="err">asmrh</span> <span class="err">cases,</span> <span class="err">a(stfips</span> <span class="err">year)</span> <span class="err">vce(cluster</span> <span class="err">stfips)
</span></code></pre></div></div>
<p>Now we can plot.</p>
<div class="language-stata highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">* Pull out the coefficients and SEs
</span><span class="err">g</span> <span class="err">coef</span> <span class="o">=</span> <span class="err">.
g</span> <span class="err">se</span> <span class="o">=</span> <span class="err">.
levelsof</span> <span class="err">shifted_ttt,</span> <span class="err">l(times)
foreach</span> <span class="err">t</span> <span class="err">in</span> <span class="p">`</span><span class="si">times</span><span class="p">'</span> <span class="err">{
</span>	<span class="err">replace</span> <span class="err">coef</span> <span class="o">=</span> <span class="err">_b[</span><span class="p">`</span><span class="si">t'.shifted_ttt] if shifted_ttt == `t</span><span class="p">'</span><span class="err">
</span>	<span class="err">replace</span> <span class="err">se</span> <span class="o">=</span> <span class="err">_se[</span><span class="p">`</span><span class="si">t'.shifted_ttt] if shifted_ttt == `t</span><span class="p">'</span><span class="err">
}
</span><span class="c1">
* Make confidence intervals
</span><span class="err">g</span> <span class="err">ci_top</span> <span class="o">=</span> <span class="err">coef</span><span class="o">+</span><span class="err">1.96</span><span class="o">*</span><span class="err">se
g</span> <span class="err">ci_bottom</span> <span class="o">=</span> <span class="err">coef</span> <span class="o">-</span> <span class="err">1.96</span><span class="o">*</span><span class="err">se
</span><span class="c1">
* Limit ourselves to one observation per quarter
* now switch back to time_to_treat to get original timing
</span><span class="err">keep</span> <span class="err">time_to_treat</span> <span class="err">coef</span> <span class="err">se</span> <span class="err">ci_</span><span class="o">*</span><span class="err">
duplicates</span> <span class="err">drop

sort</span> <span class="err">time_to_treat
</span><span class="c1">
* Create connected scatterplot of coefficients
* with CIs included with rcap
* and a line at 0 both horizontally and vertically
</span><span class="err">summ</span> <span class="err">ci_top
local</span> <span class="err">top_range</span> <span class="o">=</span> <span class="err">r(max)
summ</span> <span class="err">ci_bottom
local</span> <span class="err">bottom_range</span> <span class="o">=</span> <span class="err">r(min)

twoway</span> <span class="err">(sc</span> <span class="err">coef</span> <span class="err">time_to_treat,</span> <span class="err">connect(line))</span> <span class="c1">///</span><span class="err">
</span>	<span class="err">(rcap</span> <span class="err">ci_top</span> <span class="err">ci_bottom</span> <span class="err">time_to_treat)</span>	<span class="c1">///</span><span class="err">
</span>	<span class="err">(function</span> <span class="err">y</span> <span class="o">=</span> <span class="err">0,</span> <span class="err">range(time_to_treat))</span> <span class="c1">///</span><span class="err">
</span>	<span class="err">(function</span> <span class="err">y</span> <span class="o">=</span> <span class="err">0,</span> <span class="err">range(</span><span class="p">`</span><span class="si">bottom_range' `top_range</span><span class="p">'</span><span class="err">)</span> <span class="err">horiz),</span> <span class="c1">///</span><span class="err">
</span>	<span class="err">xtitle(</span><span class="s2">"Time to Treatment"</span><span class="err">)</span> <span class="err">caption(</span><span class="s2">"95% Confidence Intervals Shown"</span><span class="err">)
</span></code></pre></div></div>
<p>Which produces:</p>
<p><img src="/Model_Estimation/Images/Event_Study/stata_did_event_study.png" alt="DID Event Study Graph in Stata" /></p>
<p>Any further decoration or theming at that point is up to you.</p>
<p>Of course, as earlier mentioned, this analysis is subject to the critique by Sun and Abraham (2020). We can also use <strong>fixest</strong> to estimate the Sun and Abraham estimator to calculate effects separately by time-when-treated, and then aggregate to the time-to-treatment level properly, avoiding the way these estimates can “contaminate” each other in the regular model.</p>
<p>We can estimate the Sun and Abraham method using the <strong>eventstudyinteract</strong> package by Sun herself. Install by installing the <strong>github</strong> package with <code class="language-plaintext highlighter-rouge">net install github, from("https://haghish.github.io/github/")</code> and then installing <strong>eventstudyinteract</strong> with <code class="language-plaintext highlighter-rouge">github install lsun20/eventstudyinteract</code>.</p>
<p>See <code class="language-plaintext highlighter-rouge">help eventstudyinteract</code> for more information.</p>
<div class="language-stata highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">* Reload our data since we squashed it to graph
</span><span class="err">use</span> <span class="s2">"https://raw.githubusercontent.com/LOST-STATS/LOST-STATS.github.io/master/Model_Estimation/Data/Event_Study_DiD/bacon_example.dta"</span><span class="err">,</span> <span class="err">clear
</span><span class="c1">
* create the lag/lead for treated states
* fill in control obs with 0
* This allows for the interaction between `treat` and `time_to_treat` to occur for each state.
* Otherwise, there may be some NAs and the estimations will be off.
</span><span class="err">g</span> <span class="err">time_to_treat</span> <span class="o">=</span> <span class="err">year</span> <span class="o">-</span> <span class="err">_nfd
replace</span> <span class="err">time_to_treat</span> <span class="o">=</span> <span class="err">0</span> <span class="err">if</span> <span class="err">missing(_nfd)
</span><span class="c1">* this will determine the difference
* btw controls and treated states
</span><span class="err">g</span> <span class="err">treat</span> <span class="o">=</span> <span class="o">!</span><span class="err">missing(_nfd)
g</span> <span class="err">never_treat</span> <span class="o">=</span> <span class="err">missing(_nfd)
</span><span class="c1">

* Create relative-time indicators for treated groups by hand
* ignore distant leads and lags due to lack of observations
* (note this assumes any effects outside these leads/lags is 0)
</span><span class="err">tab</span> <span class="err">time_to_treat
forvalues</span> <span class="err">t</span> <span class="o">=</span> <span class="o">-</span><span class="err">9(1)16</span> <span class="err">{
</span>	<span class="err">if</span> <span class="p">`</span><span class="si">t</span><span class="p">'</span> <span class="o">&lt;</span> <span class="o">-</span><span class="err">1</span> <span class="err">{
</span>		<span class="err">local</span> <span class="err">tname</span> <span class="o">=</span> <span class="err">abs(</span><span class="p">`</span><span class="si">t</span><span class="p">'</span><span class="err">)
</span>		<span class="err">g</span> <span class="err">g_m</span><span class="p">`</span><span class="si">tname' = time_to_treat == `t</span><span class="p">'</span><span class="err">
</span>	<span class="err">}
</span>	<span class="err">else</span> <span class="err">if</span> <span class="p">`</span><span class="si">t</span><span class="p">'</span> <span class="o">&gt;=</span> <span class="err">0</span> <span class="err">{
</span>		<span class="err">g</span> <span class="err">g_</span><span class="p">`</span><span class="si">t' = time_to_treat == `t</span><span class="p">'</span><span class="err">
</span>	<span class="err">}
}

eventstudyinteract</span> <span class="err">asmrs</span> <span class="err">g_</span><span class="o">*</span><span class="err">,</span> <span class="err">cohort(_nfd)</span> <span class="err">control_cohort(never_treat)</span> <span class="err">covariates(pcinc</span> <span class="err">asmrh</span> <span class="err">cases)</span> <span class="err">absorb(i.stfips</span> <span class="err">i.year)</span> <span class="err">vce(cluster</span> <span class="err">stfips)
</span><span class="c1">
* Get effects and plot
* as of this writing, the coefficient matrix is unlabeled and so we can't do _b[] and _se[]
* instead we'll work with the results table
</span><span class="err">matrix</span> <span class="err">T</span> <span class="o">=</span> <span class="err">r(table)
g</span> <span class="err">coef</span> <span class="o">=</span> <span class="err">0</span> <span class="err">if</span> <span class="err">time_to_treat</span> <span class="o">==</span> <span class="o">-</span><span class="err">1
g</span> <span class="err">se</span> <span class="o">=</span> <span class="err">0</span> <span class="err">if</span> <span class="err">time_to_treat</span> <span class="o">==</span> <span class="o">-</span><span class="err">1
forvalues</span> <span class="err">t</span> <span class="o">=</span> <span class="o">-</span><span class="err">9(1)16</span> <span class="err">{
</span>	<span class="err">if</span> <span class="p">`</span><span class="si">t</span><span class="p">'</span> <span class="o">&lt;</span> <span class="o">-</span><span class="err">1</span> <span class="err">{
</span>		<span class="err">local</span> <span class="err">tname</span> <span class="o">=</span> <span class="err">abs(</span><span class="p">`</span><span class="si">t</span><span class="p">'</span><span class="err">)
</span>		<span class="err">replace</span> <span class="err">coef</span> <span class="o">=</span> <span class="err">T[1,colnumb(T,</span><span class="s2">"g_m`tname'"</span><span class="err">)]</span> <span class="err">if</span> <span class="err">time_to_treat</span> <span class="o">==</span> <span class="p">`</span><span class="si">t</span><span class="p">'</span><span class="err">
</span>		<span class="err">replace</span> <span class="err">se</span> <span class="o">=</span> <span class="err">T[2,colnumb(T,</span><span class="s2">"g_m`tname'"</span><span class="err">)]</span> <span class="err">if</span> <span class="err">time_to_treat</span> <span class="o">==</span> <span class="p">`</span><span class="si">t</span><span class="p">'</span><span class="err">
</span>	<span class="err">}
</span>	<span class="err">else</span> <span class="err">if</span> <span class="p">`</span><span class="si">t</span><span class="p">'</span> <span class="o">&gt;=</span> <span class="err">0</span> <span class="err">{
</span>		<span class="err">replace</span> <span class="err">coef</span> <span class="o">=</span>  <span class="err">T[1,colnumb(T,</span><span class="s2">"g_`t'"</span><span class="err">)]</span> <span class="err">if</span> <span class="err">time_to_treat</span> <span class="o">==</span> <span class="p">`</span><span class="si">t</span><span class="p">'</span><span class="err">
</span>		<span class="err">replace</span> <span class="err">se</span> <span class="o">=</span> <span class="err">T[2,colnumb(T,</span><span class="s2">"g_`t'"</span><span class="err">)]</span> <span class="err">if</span> <span class="err">time_to_treat</span> <span class="o">==</span> <span class="p">`</span><span class="si">t</span><span class="p">'</span><span class="err">
</span>	<span class="err">}
}
</span><span class="c1">
* Make confidence intervals
</span><span class="err">g</span> <span class="err">ci_top</span> <span class="o">=</span> <span class="err">coef</span><span class="o">+</span><span class="err">1.96</span><span class="o">*</span><span class="err">se
g</span> <span class="err">ci_bottom</span> <span class="o">=</span> <span class="err">coef</span> <span class="o">-</span> <span class="err">1.96</span><span class="o">*</span><span class="err">se

keep</span> <span class="err">time_to_treat</span> <span class="err">coef</span> <span class="err">se</span> <span class="err">ci_</span><span class="o">*</span><span class="err">
duplicates</span> <span class="err">drop

sort</span> <span class="err">time_to_treat
keep</span> <span class="err">if</span> <span class="err">inrange(time_to_treat,</span> <span class="o">-</span><span class="err">9,</span> <span class="err">16)
</span><span class="c1">
* Create connected scatterplot of coefficients
* with CIs included with rcap
* and a line at 0 both horizontally and vertically
</span><span class="err">summ</span> <span class="err">ci_top
local</span> <span class="err">top_range</span> <span class="o">=</span> <span class="err">r(max)
summ</span> <span class="err">ci_bottom
local</span> <span class="err">bottom_range</span> <span class="o">=</span> <span class="err">r(min)

twoway</span> <span class="err">(sc</span> <span class="err">coef</span> <span class="err">time_to_treat,</span> <span class="err">connect(line))</span> <span class="c1">///</span><span class="err">
</span>	<span class="err">(rcap</span> <span class="err">ci_top</span> <span class="err">ci_bottom</span> <span class="err">time_to_treat)</span>	<span class="c1">///</span><span class="err">
</span>	<span class="err">(function</span> <span class="err">y</span> <span class="o">=</span> <span class="err">0,</span> <span class="err">range(time_to_treat))</span> <span class="c1">///</span><span class="err">
</span>	<span class="err">(function</span> <span class="err">y</span> <span class="o">=</span> <span class="err">0,</span> <span class="err">range(</span><span class="p">`</span><span class="si">bottom_range' `top_range</span><span class="p">'</span><span class="err">)</span> <span class="err">horiz),</span> <span class="c1">///</span><span class="err">
</span>	<span class="err">xtitle(</span><span class="s2">"Time to Treatment with Sun and Abraham (2020) Estimation"</span><span class="err">)</span> <span class="err">caption(</span><span class="s2">"95% Confidence Intervals Shown"</span><span class="err">)
</span></code></pre></div></div>
          <hr>
          <footer>
              <div class="d-flex mt-2">
                  <p class="text-small text-grey-dk-000 mb-0">
                    <a href="https://github.com/lost-stats/lost-stats.github.io/edit/source/Model_Estimation/Research_Design/event_study.md" id="edit-this-page">Edit this page on GitHub.</a>
                  </p>
              </div>
          </footer>
      </div>
    </div>
      <div class="search-overlay"></div>
  </div>
</body>
</html>
