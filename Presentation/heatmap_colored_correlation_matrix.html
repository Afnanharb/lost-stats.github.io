
<!DOCTYPE html>
<html lang="en-US">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=Edge">
    <title>Heatmap Colored Correlation Matrix - LOST</title>
  <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
  <link rel="stylesheet" href="/assets/css/just-the-docs.css">
    <script type="text/javascript" src="/assets/js/vendor/lunr.min.js"></script>
  <script type="text/javascript" src="/assets/js/just-the-docs.js"></script>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!-- Begin Jekyll SEO tag v2.5.0 -->
<title>Heatmap Colored Correlation Matrix | LOST</title>
<meta name="generator" content="Jekyll v3.8.5" />
<meta property="og:title" content="Heatmap Colored Correlation Matrix" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Source code for the Library of Statistical Techniques" />
<meta property="og:description" content="Source code for the Library of Statistical Techniques" />
<meta property="og:site_name" content="LOST" />
<script type="application/ld+json">
{"description":"Source code for the Library of Statistical Techniques","headline":"Heatmap Colored Correlation Matrix","@type":"WebPage","url":"/Presentation/heatmap_colored_correlation_matrix.html","@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->
  <script type="text/x-mathjax-config">
    MathJax.Hub.Config({ TeX: { equationNumbers: { autoNumber: "AMS" } } });
  </script>
  <script type="text/javascript" async
    src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS_CHTML">
  </script>
</head>
<body>
  <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
    <symbol id="link" viewBox="0 0 16 16">
      <title>Link</title>
      <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </symbol>
  </svg>
  <div class="page-wrap">
    <div class="side-bar">
      <div class="site-header">
        <a href="" class="site-title lh-tight">
  LOST
</a>
        <button class="menu-button fs-3 js-main-nav-trigger" data-text-toggle="Hide" type="button">Menu</button>
      </div>
      <div class="navigation main-nav js-main-nav">
        <nav role="navigation" aria-label="Main navigation">
  <ul class="navigation-list"><li class="navigation-list-item"><a href="/" class="navigation-list-link">Home</a></li><li class="navigation-list-item active"><a href="/Data/" class="navigation-list-link"></a></li><li class="navigation-list-item"><a href="/Data_Manipulation/data_manipulation.html" class="navigation-list-link">Data Manipulation</a><ul class="navigation-list-child-list "><li class="navigation-list-item "><a href="/Data_Manipulation/collapse_a_data_set.html" class="navigation-list-link">Collapse a Data Set</a></li><li class="navigation-list-item "><a href="/Data_Manipulation/Combining_Datasets/combining_datasets_overview.html" class="navigation-list-link">Combining Datasets</a><ul class="navigation-list-child-list"><li class="navigation-list-item ">
                            <a href="/Data_Manipulation/Combining_Datasets/combining_datasets_vertical_combination.html" class="navigation-list-link">Vertical Combination</a>
                          </li><li class="navigation-list-item ">
                            <a href="/Data_Manipulation/Combining_Datasets/combining_datasets_horizontal_merge_deterministic.html" class="navigation-list-link">Horizontal Combination (Deterministic)</a>
                          </li></ul></li><li class="navigation-list-item "><a href="/Data_Manipulation/determine_the_observation_level_of_a_data_set.html" class="navigation-list-link">Determine the Observation Level of a Data Set</a></li><li class="navigation-list-item "><a href="/Data_Manipulation/Reshaping/reshape.html" class="navigation-list-link">Reshaping Data</a><ul class="navigation-list-child-list"><li class="navigation-list-item ">
                            <a href="/Data_Manipulation/Reshaping/reshape_panel_data_from_wide_to_long.html" class="navigation-list-link">Reshape Panel Data from Wide to Long</a>
                          </li><li class="navigation-list-item ">
                            <a href="/Data_Manipulation/Reshaping/reshape_panel_data_from_long_to_wide.html" class="navigation-list-link">Reshape Panel Data from Long to Wide</a>
                          </li></ul></li></ul></li><li class="navigation-list-item"><a href="/Geo-Spatial/Summary_Techniques.html" class="navigation-list-link">Geo-Spatial</a><ul class="navigation-list-child-list "></ul></li><li class="navigation-list-item"><a href="/Machine_Learning/Machine_Learning.html" class="navigation-list-link">Machine Learning</a><ul class="navigation-list-child-list "><li class="navigation-list-item "><a href="/Machine_Learning/penalized_regression.html" class="navigation-list-link">Penalized Regression</a></li></ul></li><li class="navigation-list-item"><a href="/Model_Estimation/Estimation.html" class="navigation-list-link">Model Estimation</a><ul class="navigation-list-child-list "><li class="navigation-list-item "><a href="/Model_Estimation/fixed_effects_in_linear_regression.html" class="navigation-list-link">Fixed Effects in Linear Regression</a></li><li class="navigation-list-item "><a href="/Model_Estimation/heckman_correction_model.html" class="navigation-list-link">Heckman Correction Model</a></li><li class="navigation-list-item "><a href="/Model_Estimation/instrumental_variables.html" class="navigation-list-link">Instrumental Variables</a></li><li class="navigation-list-item "><a href="/Model_Estimation/interaction_terms_and_polynomials.html" class="navigation-list-link">Interaction Terms and Polynomials</a></li><li class="navigation-list-item "><a href="/Model_Estimation/linear_mixed_effects_regression.html" class="navigation-list-link">Linear Mixed-Effects Regression</a></li><li class="navigation-list-item "><a href="/Model_Estimation/logit_model.html" class="navigation-list-link">Logit Model</a></li><li class="navigation-list-item "><a href="/Model_Estimation/mcfaddens_choice_model.html" class="navigation-list-link">McFadden's Choice Model (Alternative-Specific Conditional Logit)</a></li><li class="navigation-list-item "><a href="/Model_Estimation/ordinary_least_squares.html" class="navigation-list-link">Ordinary Least Squares (Linear Regression)</a></li><li class="navigation-list-item "><a href="/Model_Estimation/probit_model.html" class="navigation-list-link">Probit Model</a></li><li class="navigation-list-item "><a href="/Model_Estimation/Nonstandard_Errors/nonstandard_errors.html" class="navigation-list-link">Nonstandard Errors</a><ul class="navigation-list-child-list"><li class="navigation-list-item ">
                            <a href="/Model_Estimation/Nonstandard_Errors/clustered_se.html" class="navigation-list-link">Cluster-Robust Standard Errors</a>
                          </li><li class="navigation-list-item ">
                            <a href="/Model_Estimation/Nonstandard_Errors/hc_se.html" class="navigation-list-link">Heteroskedasticity-consistent standard errors</a>
                          </li></ul></li></ul></li><li class="navigation-list-item active"><a href="/Presentation/Presentation.html" class="navigation-list-link">Presentation</a><ul class="navigation-list-child-list "><li class="navigation-list-item "><a href="/Presentation/export_a_formatted_regression_table.html" class="navigation-list-link">Export a Formatted Regression Table</a></li><li class="navigation-list-item  active"><a href="/Presentation/heatmap_colored_correlation_matrix.html" class="navigation-list-link active">Heatmap Colored Correlation Matrix</a></li><li class="navigation-list-item "><a href="/Presentation/line_graph_with_labels_at_the_beginning_or_end.html" class="navigation-list-link">Line Graph with Labels at the Beginning or End of Lines</a></li><li class="navigation-list-item "><a href="/Presentation/marginal_effects_plots_for_interactions_with_continuous_variables.html" class="navigation-list-link">Marginal Effects Plots for Interactions with Continuous Variables</a></li><li class="navigation-list-item "><a href="/Presentation/scatterplot_by_group_on_shared_axes.html" class="navigation-list-link">Scatterplot by Group on Shared Axes</a></li></ul></li><li class="navigation-list-item"><a href="/Summary_Statistics/Summary_Statistics.html" class="navigation-list-link">Summary Statistics</a><ul class="navigation-list-child-list "><li class="navigation-list-item "><a href="/Summary_Statistics/Balance_Tables.html" class="navigation-list-link">Balance Table</a></li></ul></li><li class="navigation-list-item"><a href="/Time_Series/Time_Series.html" class="navigation-list-link">Time Series</a><ul class="navigation-list-child-list "></ul></li><li class="navigation-list-item"><a href="/Other/Other.html" class="navigation-list-link">Other</a><ul class="navigation-list-child-list "><li class="navigation-list-item "><a href="/Other/import_a_foreign_data_file.html" class="navigation-list-link">Import a Foreign Data File</a></li></ul></li><li class="navigation-list-item"><a href="/Desired_Nonexistent_Pages/desired_nonexistent_pages.html" class="navigation-list-link">Desired Nonexistent Pages</a></li><li class="navigation-list-item"><a href="/Contributing/Contributing.html" class="navigation-list-link">Contributing</a></li></ul>
</nav>
      </div>
      <footer class="site-footer">
        <p class="text-small text-grey-dk-000 mb-4">This site uses <a href="https://github.com/pmarsceill/just-the-docs">Just the Docs</a>, a documentation theme for Jekyll.</p>
      </footer>
    </div>
    <div class="main-content-wrap js-main-content" tabindex="0">
      <div class="main-content">
        <div class="page-header js-page-header">
          <div class="search">
            <div class="search-input-wrap">
              <input type="text" class="js-search-input search-input" tabindex="0" placeholder="Search LOST" aria-label="Search LOST" autocomplete="off">
              <svg width="14" height="14" viewBox="0 0 28 28" xmlns="http://www.w3.org/2000/svg" class="search-icon"><title>Search</title><g fill-rule="nonzero"><path d="M17.332 20.735c-5.537 0-10-4.6-10-10.247 0-5.646 4.463-10.247 10-10.247 5.536 0 10 4.601 10 10.247s-4.464 10.247-10 10.247zm0-4c3.3 0 6-2.783 6-6.247 0-3.463-2.7-6.247-6-6.247s-6 2.784-6 6.247c0 3.464 2.7 6.247 6 6.247z"/><path d="M11.672 13.791L.192 25.271 3.02 28.1 14.5 16.62z"/></g></svg>
            </div>
            <div class="js-search-results search-results-wrap"></div>
          </div>
            <ul class="list-style-none text-small aux-nav">
                <li class="d-inline-block my-0"><a href="https://github.com/lost-stats/lost-stats.github.io/blob/source/Presentation/heatmap_colored_correlation_matrix.md">Edit this page on GitHub</a></li>
            </ul>
        </div>
        <div class="page">
              <nav class="breadcrumb-nav">
                <ol class="breadcrumb-nav-list">
                    <li class="breadcrumb-nav-list-item"><a href="/Presentation/Presentation.html">Presentation</a></li>
                  <li class="breadcrumb-nav-list-item"><span>Heatmap Colored Correlation Matrix</span></li>
                </ol>
              </nav>
          <div id="main-content" class="page-content" role="main">
              <h1 id="heatmap-colored-correlation-matrix">
          <a href="#heatmap-colored-correlation-matrix" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#link"></use></svg></a> Heatmap Colored Correlation Matrix
      </h1>
<p>A correlation matrix shows the correlation between different variables in a matrix setting. However, because these matrices have so many numbers on them, they can be difficult to follow. Heatmap coloring of the matrix, where one color indicates a positive correlation, another indicates a negative correlation, and the shade indicates the strength of correlation, can make these matrices easier for the reader to understand.</p>
      <h2 id="keep-in-mind">
          <a href="#keep-in-mind" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#link"></use></svg></a> Keep in Mind
      </h2>
<ul>
  <li>Even with heatmap coloring, very large correlation matrices can still be difficult to read, as you must pinpoint which variable names go with which cell of the matrix. Consider breaking big correlation matrices up into smaller ones, or limiting the amount of data you’re trying to show in some other way.</li>
</ul>
      <h2 id="also-consider">
          <a href="#also-consider" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#link"></use></svg></a> Also Consider
      </h2>
<ul>
  <li>You may just want to <a href="https://lost-stats.github.io/Summary_Statistics/correlation_matrix.html">create a correlation matrix</a></li>
</ul>
      <h1 id="implementations">
          <a href="#implementations" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#link"></use></svg></a> Implementations
      </h1>
      <h2 id="python">
          <a href="#python" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#link"></use></svg></a> Python
      </h2>
<p>We present two ways you can create a heatmap. First, the <a href="https://seaborn.pydata.org/"><strong>seaborn</strong></a> package has a great collection of premade plots, one of which is a heatmap we’ll use. The second we’ll only point you to, which is a “by hand” approach that will allow you more customization.</p>
<p>For the by hand approach, see <a href="https://towardsdatascience.com/better-heatmaps-and-correlation-matrix-plots-in-python-41445d0f2bec">this guide</a>.</p>
<p>For the seaborn approach, you will need to <code class="highlighter-rouge">pip install seaborn</code> or <code class="highlighter-rouge">conda install seaborn</code> before continuing. Once you’ve done that, the follow code will produce the below plot.</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Ganked from https://seaborn.pydata.org/examples/many_pairwise_correlations.html
# Assumes you have run `pip install numpy pandas matplotlib scikit-learn seaborn`
</span>
<span class="c1"># Standard imports
</span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="n">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="n">pd</span>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">pyplot</span> <span class="k">as</span> <span class="n">plt</span>

<span class="c1"># For this example we'll use Seaborn, which has some nice built in plots
</span><span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="n">sns</span>

<span class="c1"># Grab a data set from scikit-learn
</span><span class="kn">from</span> <span class="nn">sklearn.datasets</span> <span class="kn">import</span> <span class="n">fetch_california_housing</span>

<span class="n">data</span> <span class="o">=</span> <span class="n">fetch_california_housing</span><span class="p">()</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
    <span class="n">np</span><span class="o">.</span><span class="n">c_</span><span class="p">[</span><span class="n">data</span><span class="p">[</span><span class="s">'data'</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="s">'target'</span><span class="p">]],</span>
    <span class="n">columns</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s">'feature_names'</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="s">'target'</span><span class="p">]</span>
<span class="p">)</span>

<span class="c1"># Create the correlation matrix
</span><span class="n">corr</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">corr</span><span class="p">()</span>

<span class="c1"># Generate a mask for the upper triangle; True = do NOT show
</span><span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">corr</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="nb">bool</span><span class="p">)</span>
<span class="n">mask</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">triu_indices_from</span><span class="p">(</span><span class="n">mask</span><span class="p">)]</span> <span class="o">=</span> <span class="bp">True</span>

<span class="c1"># Set up the matplotlib figure
</span><span class="n">f</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">11</span><span class="p">,</span> <span class="mi">9</span><span class="p">))</span>

<span class="c1"># Generate a custom diverging colormap
</span><span class="n">cmap</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">diverging_palette</span><span class="p">(</span><span class="mi">220</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="n">as_cmap</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

<span class="c1"># Draw the heatmap with the mask and correct aspect ratio
# More details at https://seaborn.pydata.org/generated/seaborn.heatmap.html
</span><span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span>
    <span class="n">corr</span><span class="p">,</span>          <span class="c1"># The data to plot
</span>    <span class="n">mask</span><span class="o">=</span><span class="n">mask</span><span class="p">,</span>     <span class="c1"># Mask some cells
</span>    <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span>     <span class="c1"># What colors to plot the heatmap as
</span>    <span class="n">annot</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>    <span class="c1"># Should the values be plotted in the cells?
</span>    <span class="n">vmax</span><span class="o">=</span><span class="mf">.3</span><span class="p">,</span>       <span class="c1"># The maximum value of the legend. All higher vals will be same color
</span>    <span class="n">vmin</span><span class="o">=-</span><span class="mf">.3</span><span class="p">,</span>      <span class="c1"># The minimum value of the legend. All lower vals will be same color
</span>    <span class="n">center</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>      <span class="c1"># The center value of the legend. With divergent cmap, where white is
</span>    <span class="n">square</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>   <span class="c1"># Force cells to be square
</span>    <span class="n">linewidths</span><span class="o">=</span><span class="mf">.5</span><span class="p">,</span> <span class="c1"># Width of lines that divide cells
</span>    <span class="n">cbar_kws</span><span class="o">=</span><span class="p">{</span><span class="s">"shrink"</span><span class="p">:</span> <span class="mf">.5</span><span class="p">}</span>  <span class="c1"># Extra kwargs for the legend; in this case, shrink by 50%
</span><span class="p">)</span>

<span class="c1"># You can save this as a png with
# f.savefig('heatmap_colored_correlation_matrix_seaborn_python.png')
</span></code></pre></div></div>
<p><img src="https://lost-stats.github.io/Presentation/Images/Heatmap-Colored-Correlation-Matrix/heatmap_colored_correlation_matrix_seaborn_python.png" alt="Heatmap Colored Correlation Matrix in Python using Seaborn" /></p>
      <h2 id="r">
          <a href="#r" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#link"></use></svg></a> R
      </h2>
<p>We will be creating our heatmap in two different ways. First, we will be using the <strong>corrplot</strong> package, which is tailor-made for the task and is very easy to use. Then, we will be using <strong>ggplot2</strong> with <code class="highlighter-rouge">geom_tile</code>, which requires <em>much</em> more preprocessing to use, but then provides access to the entirety of the <strong>ggplot2</strong> package for customization.</p>
<p>First, we will use <strong>corrplot</strong>:</p>
<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Install the corrplot package if necessary</span><span class="w">
</span><span class="c1"># install.packages('corrplot')</span><span class="w">

</span><span class="c1"># Load in the corrplot package</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">corrplot</span><span class="p">)</span><span class="w">

</span><span class="c1"># Load in mtcars data</span><span class="w">
</span><span class="n">data</span><span class="p">(</span><span class="n">mtcars</span><span class="p">)</span><span class="w">

</span><span class="c1"># Don't use too many variables or it will get messy!</span><span class="w">
</span><span class="n">mtcars</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">mtcars</span><span class="p">[,</span><span class="nf">c</span><span class="p">(</span><span class="s1">'mpg'</span><span class="p">,</span><span class="s1">'cyl'</span><span class="p">,</span><span class="s1">'disp'</span><span class="p">,</span><span class="s1">'hp'</span><span class="p">,</span><span class="s1">'drat'</span><span class="p">,</span><span class="s1">'wt'</span><span class="p">,</span><span class="s1">'qsec'</span><span class="p">)]</span><span class="w">

</span><span class="c1"># Create a corrgram</span><span class="w">
</span><span class="n">corrplot</span><span class="p">(</span><span class="n">cor</span><span class="p">(</span><span class="n">mtcars</span><span class="p">),</span><span class="w">
         </span><span class="c1"># Using the color method for a heatmap</span><span class="w">
         </span><span class="n">method</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'color'</span><span class="p">,</span><span class="w">
         </span><span class="c1"># And the lower half only for easier readability</span><span class="w">
         </span><span class="n">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'lower'</span><span class="p">,</span><span class="w">
         </span><span class="c1"># Omit the 1's along the diagonal to bring variable names closer</span><span class="w">
         </span><span class="n">diag</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">,</span><span class="w">
         </span><span class="c1"># Add the number on top of the color</span><span class="w">
         </span><span class="n">addCoef.col</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'black'</span><span class="w">
         </span><span class="p">)</span><span class="w">
</span></code></pre></div></div>
<p>This results in:</p>
<p><img src="https://lost-stats.github.io/Presentation/Images/Heatmap-Colored-Correlation-Matrix/heatmap_colored_correlation_matrix_corrplot_R.png" alt="Heatmap Colored Correlation Matrix in R using Corrplot" /></p>
<p>Now we will make the graph using <strong>ggplot2</strong>. We will also make a little use of <strong>dplyr</strong> and <strong>tidyr</strong>, and so we’ll load them all as a part of the <strong>tidyverse</strong>. This example makes use of <a href="http://www.sthda.com/english/wiki/ggplot2-quick-correlation-matrix-heatmap-r-software-and-data-visualization">this guide</a>.</p>
<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Install the tidyverse if necessary</span><span class="w">
</span><span class="c1"># install.packages('tidyverse')</span><span class="w">

</span><span class="c1"># Load in the tidyverse</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">tidyverse</span><span class="p">)</span><span class="w">

</span><span class="c1"># Load in mtcars data</span><span class="w">
</span><span class="n">data</span><span class="p">(</span><span class="n">mtcars</span><span class="p">)</span><span class="w">

</span><span class="c1"># Create a correlation matrix.</span><span class="w">
</span><span class="n">C</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">mtcars</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="c1"># Don't use too many variables or it will get messy!</span><span class="w">
  </span><span class="c1"># We use dplyr's select() here but there are other ways to limit variables, like []</span><span class="w">
  </span><span class="n">select</span><span class="p">(</span><span class="n">cyl</span><span class="p">,</span><span class="w"> </span><span class="n">disp</span><span class="p">,</span><span class="w"> </span><span class="n">drat</span><span class="p">,</span><span class="w"> </span><span class="n">hp</span><span class="p">,</span><span class="w"> </span><span class="n">mpg</span><span class="p">,</span><span class="w"> </span><span class="n">qsec</span><span class="p">,</span><span class="w"> </span><span class="n">wt</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="c1"># Correlation matrix</span><span class="w">
  </span><span class="n">cor</span><span class="p">()</span><span class="w"> 

</span><span class="c1"># At this point, we can limit the matrix to just its lower half</span><span class="w">
</span><span class="c1"># Note this will give weird results if you didn't select variables in alphabetical order earlier</span><span class="w">
</span><span class="n">C</span><span class="p">[</span><span class="n">upper.tri</span><span class="p">(</span><span class="n">C</span><span class="p">)]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="kc">NA</span><span class="w">

</span><span class="n">C</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">C</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="c1"># Turn it into a data frame</span><span class="w">
  </span><span class="n">as.data.frame</span><span class="p">()</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="c1"># with a column for the variable names.</span><span class="w">
  </span><span class="c1"># We use dplyr's mutate to create this column but it could be made with $</span><span class="w">
  </span><span class="c1"># the . here means "the data set we're working with"</span><span class="w">
  </span><span class="n">mutate</span><span class="p">(</span><span class="n">Variable</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">row.names</span><span class="p">(</span><span class="n">.</span><span class="p">))</span><span class="w">



</span><span class="c1"># Use tidyr's pivot_longer to reshape to long format</span><span class="w">
</span><span class="c1"># There are other ways to reshape too</span><span class="w">
</span><span class="n">C_Long</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">pivot_longer</span><span class="p">(</span><span class="n">C</span><span class="p">,</span><span class="w"> </span><span class="n">cols</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="n">mpg</span><span class="p">,</span><span class="w"> </span><span class="n">cyl</span><span class="p">,</span><span class="w"> </span><span class="n">disp</span><span class="p">,</span><span class="w"> </span><span class="n">hp</span><span class="p">,</span><span class="w"> </span><span class="n">drat</span><span class="p">,</span><span class="w"> </span><span class="n">wt</span><span class="p">,</span><span class="w"> </span><span class="n">qsec</span><span class="p">),</span><span class="w">
                       </span><span class="c1"># We will want this option for sure if we dropped the</span><span class="w">
                       </span><span class="c1"># upper half of the triangle earlier</span><span class="w">
                       </span><span class="n">values_drop_na</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="c1"># Make both variables into factors</span><span class="w">
  </span><span class="n">mutate</span><span class="p">(</span><span class="n">Variable</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">factor</span><span class="p">(</span><span class="n">Variable</span><span class="p">),</span><span class="w">
         </span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">factor</span><span class="p">(</span><span class="n">name</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="c1"># Reverse the order of one of the variables so that the x and y variables have</span><span class="w">
  </span><span class="c1"># Opposing orders, common for a correlation matrix</span><span class="w">
  </span><span class="n">mutate</span><span class="p">(</span><span class="n">Variable</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">factor</span><span class="p">(</span><span class="n">Variable</span><span class="p">,</span><span class="w"> </span><span class="n">levels</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rev</span><span class="p">(</span><span class="n">levels</span><span class="p">(</span><span class="n">.</span><span class="o">$</span><span class="n">Variable</span><span class="p">))))</span><span class="w">

</span><span class="c1"># Now we graph!</span><span class="w">
</span><span class="n">ggplot</span><span class="p">(</span><span class="n">C_Long</span><span class="p">,</span><span class="w">
       </span><span class="c1"># Our x and y axis are Variable and name</span><span class="w">
       </span><span class="c1"># And we want to fill each cell with the value</span><span class="w">
       </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Variable</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">fill</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">value</span><span class="p">))</span><span class="o">+</span><span class="w">
  </span><span class="c1"># geom_tile to draw the graph</span><span class="w">
  </span><span class="n">geom_tile</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="c1"># Color the graph as we like</span><span class="w">
  </span><span class="c1"># Here our negative correlations are red, positive are blue</span><span class="w">
  </span><span class="c1"># gradient2 instead of gradient gives us a "mid" color which we can make white</span><span class="w">
  </span><span class="n">scale_fill_gradient2</span><span class="p">(</span><span class="n">low</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"red"</span><span class="p">,</span><span class="w"> </span><span class="n">high</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"blue"</span><span class="p">,</span><span class="w"> </span><span class="n">mid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"white"</span><span class="p">,</span><span class="w"> 
                       </span><span class="n">midpoint</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="n">limit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">-1</span><span class="p">,</span><span class="m">1</span><span class="p">),</span><span class="w"> </span><span class="n">space</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Lab"</span><span class="p">,</span><span class="w"> 
                       </span><span class="n">name</span><span class="o">=</span><span class="s2">"Pearson\nCorrelation"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="c1"># Axis names don't make much sense </span><span class="w">
  </span><span class="n">labs</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">NULL</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">NULL</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> 
  </span><span class="c1"># We don't need that background</span><span class="w">
  </span><span class="n">theme_minimal</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="c1"># If we need more room for variable names at the bottom, rotate them</span><span class="w">
  </span><span class="n">theme</span><span class="p">(</span><span class="n">axis.text.x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">element_text</span><span class="p">(</span><span class="n">angle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">45</span><span class="p">,</span><span class="w"> </span><span class="n">vjust</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> 
                                   </span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">12</span><span class="p">,</span><span class="w"> </span><span class="n">hjust</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w"> 
  </span><span class="c1"># We want those cells to be square!</span><span class="w">
  </span><span class="n">coord_fixed</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="c1"># If you also want the correlations to be written directly on there, add geom_text</span><span class="w">
  </span><span class="n">geom_text</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">label</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">round</span><span class="p">(</span><span class="n">value</span><span class="p">,</span><span class="m">3</span><span class="p">)))</span><span class="w">
</span></code></pre></div></div>
<p>This results in:</p>
<p><img src="https://lost-stats.github.io/Presentation/Images/Heatmap-Colored-Correlation-Matrix/heatmap_colored_correlation_matrix_ggplot2_r.png" alt="Heatmap Colored Correlation Matrix in R using ggplot2" /></p>
      <h2 id="sas">
          <a href="#sas" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#link"></use></svg></a> SAS
      </h2>
<p>See <a href="https://blogs.sas.com/content/sasdummy/2013/06/12/correlations-matrix-heatmap-with-sas/">this guide</a>.</p>
      <h2 id="stata">
          <a href="#stata" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#link"></use></svg></a> Stata
      </h2>
<p>Stata has the installable package <strong>corrtable</strong> which produces heatmap correlation tables. Handily, it puts the variable labels (or names, if labels aren’t available) along the diagonal where they are easy to read. Note that it does run quite slowly.</p>
<div class="language-stata highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">* Install corrtable if necessary
* ssc install corrtable

* Get auto data
</span><span class="err">sysuse</span> <span class="err">auto.dta,</span> <span class="err">clear
</span><span class="c1">
* Make correlation table
* The half option just shows the lower triangle and puts variable names on the axis.
* The flag1 and howflag1 options tell corrtable to plot positive correlations (r(rho &gt; 0))
* as blue (blue*.1)
* and flag2 and howflag2 similarly tell it to plot negative correlations as pink.
</span><span class="err">corrtable</span> <span class="err">price</span><span class="o">-</span><span class="err">length,</span> <span class="err">half</span> <span class="err">flag1(r(rho)</span> <span class="o">&gt;</span> <span class="err">0)</span> <span class="err">howflag1(plotregion(color(blue</span> <span class="o">*</span> <span class="err">0.1)))</span> <span class="err">flag2(r(rho)</span> <span class="o">&lt;</span> <span class="err">0)</span> <span class="err">howflag2(plotregion(color(pink</span><span class="o">*</span><span class="err">0.1)))
</span></code></pre></div></div>
<p>This results in:</p>
<p><img src="https://lost-stats.github.io/Presentation/Images/Heatmap-Colored-Correlation-Matrix/heatmap_colored_correlation_matrix_stata.png" alt="Heatmap Colored Correlation Matrix in Stata" /></p>
        </div>
      </div>
    </div>
  </div>
</body>
</html>
